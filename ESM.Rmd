\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE}
# Set your working directory

# Load your packages
library(tidyverse);library(dataRetrieval);library(lubridate);library(remotes)
library(ggplot2);library(ggthemes);library(rlang);library(ecodist) 
#install_github("USEPA/StreamCatTools", build_vignettes=TRUE, force=TRUE)
library("StreamCatTools") # This imports EPA's tool for StreamCat data

# Set your ggplot theme
starwars <- theme_base() +  
  theme( # Pulled from John's theme template code
    line = element_line(color = "white"), 
    rect = element_rect(fill = "black"),
    text = element_text(color = "yellow"), 
    
    # Modified inheritance structure of text element
    #plot.title = element_text(color = "yellow"), 
    #axis.title.x =      element_blank(),
    #axis.title.y =      element_blank(),
    #axis.text = element_text(color = "yellow"), 
    
    # Modified inheritance structure of line element
    axis.ticks = element_line(color = "yellow"),
    panel.grid.major = element_line(color = "yellow", 
                                    linetype = "dashed"),
    
    # Modified inheritance structure of rect element
    #plot.background = element_rect(fill = "black"),
    #panel.background = element_rect(fill = "black")
    #legend.key =        element_rect(),
    
    # Modifiying legend.position
    #legend.position = 'right',
    
    #complete = TRUE
    )
```

``` {r data wrangling}
# Load the data

# Pulling NLCD from StreamCat for every COMID in TX for every year available

years <- c(2001, 2004, 2006, 2008, 2011, 2013, 2016, 2019)
length(years) # 8 years

nlcd <- data.frame() # Create empty dataframe to be filled

for (i in 1:8) { # For each year for which there are NLCD...
  nlcd_i <- sc_nlcd(years[i], state = "TX") # Create temporary df for this year
  nlcd_i$Year = years[i] # Denote which year these data are from
  for (col in 1:ncol(nlcd_i)){
    colnames(nlcd_i)[col] <- sub(years[i], "", colnames(nlcd_i)[col])
  } # All the column names have the year in them. I want them removed
  nlcd <- rbind(nlcd, nlcd_i) # Adjoin to growing dataframe of all NLCD
  rm(nlcd_i) # Remove the temporary dataframe
}

summary(nlcd) # Check the resulting dataframe
# All the fields starting with "PCT" should have a max of 100.00
# Year should run from min: 2001 to max: 2019
# I note there are a lot of NA's; we'll remove those later

# List of Eurycea species found in each COMID (from my MP)
species <- read.csv("species.csv", stringsAsFactors = TRUE)
summary(species) # This gives a sense of which species have most presences

# Pull BFI for every COMID in TX (this is comparably easy)
bfi <- sc_get_data(metric = "BFI", state = "TX")
summary(bfi) # Again we see a lot of NA's, to be removed later

# Assemble the final dataframe
nlcd_bfi <- merge(nlcd, bfi) # Intermediary df with the env. variables
Eurycea <- merge(species, nlcd_bfi) # Adjoin to salamander presences
rm(nlcd_bfi)#;rm(bfi);rm(nlcd)

# Clean up the dataframe
Eurycea <- unique(Eurycea) # Remove duplicates
Eurycea <- drop_na(Eurycea) # Remove NA's

```


# Rationale and Research Questions

Genetic testing has delineated fourteen species of Eurycea cave salamanders in central Texas, three of which are undescribed (Devitt et al. 2019). These undescribed species are new to science and therefore enjoy no protections under the Endangered Species Act (ESA). The first of these species was the subject of a petition by Save our Springs Alliance (SOS) to the U.S. Fish and Wildlife Service (USFWS) for its protection (Datri 2021). This petition passed its initial review and USFWS is now considering the species for protection (FWS 2022). Anthropogenic development including land cover change and groundwater overdraft pose the largest threats to Eurycea species by destroying forests that protect their habitats and draining the groundwater in which they live (Datri 2021).

During the 2022-2023 school year, I worked with Rory Kuczek on a NSOE master's project for SOS to facilitate and strengthen future petitions by analyzing habitat threats to these undescribed species. Kuczek and I used MaxEnt and nonmetric multidimensional scaling (NMS) statistical methods to test the association of Eurycea species presences with 13 catchment-level environmental metrics from the StreamCat dataset. Both methods identified that undescribed Eurycea species 2 and 3 presences were most dependent on base flow index (BFI), a ratio of groundwater discharge to total surface flow.

Building on these results, I intend to test two research questions related to habitat degradation for Eurycea species 2 and 3.

1. Has developed land cover (at the catchment and watershed level) increased over time at the known habitats of species 2 and 3?

2. Between species 2 and species 3, which species' habitat has a higher percentage and/or rate of increase for developed land cover?

3. How do these land cover changes (if any) compare to rates of change throughout Texas?

4. Across Texas, are increases in developed land cover over time associated with higher levels of BFI?

Answers to these questions will paint a clearer picture of development in Eurycea species 2 and 3 habitat, potentially contributing to the urgency of protecting their habitat in subsequent petitions to USFWS.

\newpage

# Dataset Information

The StreamCat dataset details over 600 natural and anthropogenic metrics for streams in the contintental US at the catchment and watershed levels. The dataset includes robust web services such as a REST API and R package to facilitate data management. StreamCat is maintained by EPA as part of the National Aquatic Resource Surveys. Use of this dataset for analysis of Eurycea salamander species was recommended by John Fay.

```{r StreamCat example}

region_params <- sc_get_params(param='areaOfInterest')
region_params
name_params <- sc_get_params(param='name')

metric='bfi'
fullname <- sc_fullname(metric)
print(paste0('The full name for ',metric, ' is: ', paste(fullname,collapse = ', ')))

```

\newpage

# Exploratory Analysis 

```{r poking around}

# Behold the assembled dataframe
summary(Eurycea)

# Delinate non-numeric columns for ease of exclusion
non_num <- names(Eurycea) %in% c("Species","STATE")



```

\newpage

# Analysis

```{r meat on the bone}



```

## Question 1:



## Question 2: 



\newpage

# Summary and Conclusions



\newpage

# References

Datri, Crystal (2021). “Petition to the U.S. Fish and Wildlife Service to List the Pedernales River Springs Salamander as a Threatened or Endangered Species Under the Endangered Species Act.”

Devitt, T. J., Wright, A. M., Cannatella, D. C., & Hillis, D. M. (2019). Species delimitation in endangered groundwater salamanders: Implications for aquifer management and biodiversity conservation. Proceedings of the National Academy of Sciences, 116(7), 2624-2633.

Service Completes Initial Reviews on Endangered Species Act Petitions for Four Species | U.S. Fish & Wildlife Service. 2022 Oct 18. FWSgov. [accessed 2023 May 1]. https://fws.gov/press-release/2022-10/service-completes-initial-reviews-endangered-species-act-petitions-four.

Weber M (2023). StreamCatTools: Streamcat Tools. R package version 0.1.1.9002, https://usepa.github.io/StreamCatTools/. 
